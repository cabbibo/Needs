
<html>

<head>
  <style>

    html{ color:#fff; background:#000; }

    #container{
      width      : 100%;
      height     : 100%;
      position   : absolute;
      top        : 0px;
      left       : 0px;
      background : #000;
    }

  </style>
</head>
<body>

<script src = "lib/underscore.js"         ></script>
<script src = "lib/three.js"              ></script>
<script src = "lib/jquery.min.js"         ></script>
<script src = "lib/ShaderLoader.js"       ></script>
<script src = "lib/TrackballControls.js"  ></script>

<script src = "lib/Stream.js"             ></script>
<script src = "lib/UserAudio.js"          ></script>
<script src = "lib/AudioController.js"    ></script>
<script src = "lib/AudioTexture.js"       ></script>

<script src = "js/LinkArch.js"            ></script>

<script>

  var sceneSize = 5000;
  //init();
  //animate();

  var clock = new THREE.Clock();
  
  var audioController = new AudioController();

 // audioController.mute.gain.value = 0;
 
  var timer = { type:"f" , value:0 }
  var dT = { type:"f" , value:0 }
  var stream = new Stream(  'audio/needs.mp3',audioController  );

  var userMedia = new UserAudio( audioController );
  console.log( userMedia );

 /* userMedia.onStreamCreated = function(){

    init();
    animate();

  }*/
  
   var shaders = new ShaderLoader('shaders');


  shaders.load( 'vs-curve' , 'curve' , 'vertex' );
  shaders.load( 'fs-curve' , 'curve' , 'fragment' );
  
  shaders.load( 'vs-bee' , 'bee' , 'vertex' );
  shaders.load( 'fs-bee' , 'bee' , 'fragment' );

  shaders.shaderSetLoaded = function(){

     init();
    animate();
    stream.play();

  }

  var t_combo = THREE.ImageUtils.loadTexture( 'img/iri/t_combo.png' );

  var t_red         = THREE.ImageUtils.loadTexture( 'img/iri/red.png' );
  var t_turq        = THREE.ImageUtils.loadTexture( 'img/iri/turq.png' );
  var t_pinkRed     = THREE.ImageUtils.loadTexture( 'img/iri/pinkRed.png' );
  var t_gold        = THREE.ImageUtils.loadTexture( 'img/iri/gold.png' );
  var t_combo       = THREE.ImageUtils.loadTexture( 'img/iri/combo.png' );
  var t_yellowPurp  = THREE.ImageUtils.loadTexture( 'img/iri/neonYellowPurp.png' );
  var t_wet         = THREE.ImageUtils.loadTexture( 'img/iri/greenBluePurp.png' );
  var t_orangeTurq  = THREE.ImageUtils.loadTexture( 'img/iri/orangeTurq.png' );

  var n_carbon = THREE.ImageUtils.loadTexture( 'img/normals/carbonFiber.png' );
  var n_snow   = THREE.ImageUtils.loadTexture( 'img/normals/ice-snow.jpg' );
  var n_sand   = THREE.ImageUtils.loadTexture( 'img/normals/sand.png' );
  var n_rock   = THREE.ImageUtils.loadTexture( 'img/normals/rock.png' );
  var n_ice    = THREE.ImageUtils.loadTexture( 'img/normals/7723-normal.jpg' );
  var n_moss   = THREE.ImageUtils.loadTexture( 'img/normals/moss_normal_map.jpg' );



function init(){

    scene = new THREE.Scene();
    
    camera = new THREE.PerspectiveCamera( 
      50 ,
      window.innerWidth / window.innerHeight,
      sceneSize / 100 ,
      sceneSize * 40
    );

    // placing our camera position so it can see everything
    camera.position.z = sceneSize;

    camera.velocity = new THREE.Vector3();

    controls = new THREE.TrackballControls( camera );

    // Getting the container in the right location
    container     = document.createElement( 'div' );
    container.id  = 'container';
    
    document.body.appendChild( container );


    // Setting up our Renderer
    renderer = new THREE.WebGLRenderer();

    renderer.setSize( window.innerWidth, window.innerHeight );
    container.appendChild( renderer.domElement );


    // Making sure our renderer is always the right size
    window.addEventListener( 'resize', onWindowResize , false );

   
    var tNormal   = n_ice;

    tNormal.wrapS = THREE.RepeatWrapping; 
    tNormal.wrapT = THREE.RepeatWrapping; 
  
    var uniforms = {

      lightPos: { type:"v3" , value: new THREE.Vector3() },
      tNormal:{type:"t",value:tNormal},
      time:timer,
      t_iri:{ type:"t" , value: t_turq },
      t_audio:{ type:"t" , value: audioController.texture },
      texScale:{type:"f" , value:.001},
      normalScale:{type:"f" , value:.3},

    }

    vertexShader   = shaders.vertexShaders.curve;
    fragmentShader = shaders.fragmentShaders.curve;

    var material = new THREE.ShaderMaterial({

      uniforms: uniforms,
      vertexShader: vertexShader,
      fragmentShader: fragmentShader

    });

    var linkArch = new LinkArch( material );


    CUBE_VEL = new THREE.Vector3( 0 , 1 , 0 );
    var tNormal   = n_moss;

    tNormal.wrapS = THREE.RepeatWrapping; 
    tNormal.wrapT = THREE.RepeatWrapping; 
  
    var uniforms = {

      lightPos: { type:"v3" , value: new THREE.Vector3() },
      tNormal:{type:"t",value:tNormal},
      time:timer,
      t_iri:{ type:"t" , value: t_yellowPurp },
      t_audio:{ type:"t" , value: audioController.texture },
      texScale:{type:"f" , value:.01},
      normalScale:{type:"f" , value:2.3},
      vVel:{ type:"v3" , value: CUBE_VEL }
    
    }

    vertexShader   = shaders.vertexShaders.bee;
    fragmentShader = shaders.fragmentShaders.bee;

    var material = new THREE.ShaderMaterial({

      uniforms: uniforms,
      vertexShader: vertexShader,
      fragmentShader: fragmentShader

    });


    //var g = new THREE.BoxGeometry( 300 , 300 ,300 ,100,100,100 );
    var g = new THREE.IcosahedronGeometry( 3000 , 6 );
    g.computeFaceNormals();
    g.computeVertexNormals();
    var mesh = new THREE.Mesh( 
    g,
    material
    );

    //mesh.position.y = 2000;
    //scene.add( mesh );

}


function animate(){


  CUBE_VEL.x = Math.sin( timer.value * .1 );
  CUBE_VEL.y = Math.sin( timer.value * .3);
  CUBE_VEL.z = Math.sin( timer.value * .5);

  CUBE_VEL.normalize();

   audioController.update();
    dT.value = clock.getDelta();
    timer.value += dT.value;
  controls.update();
  renderer.render( scene , camera );

  requestAnimationFrame( animate );

}

// Resets the renderer to be the proper size
function onWindowResize(){

  camera.aspect = window.innerWidth / window.innerHeight;
  camera.updateProjectionMatrix();

  renderer.setSize( window.innerWidth, window.innerHeight );

}

</script>
</body>
</html>




